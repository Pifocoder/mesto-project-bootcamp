(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/exp-mipt-fbc-1",headers:{authorization:"58e60213-80d2-49f3-ad11-fbf6d1aa4eb4","Content-Type":"application/json"}},t=document.querySelector(".popup-profile__form"),n=t.querySelector('[name="profile-name"]'),o=t.querySelector('[name="profile-bio"]'),r=t.querySelector(".popup-profile__button"),a=document.querySelector(".popup-profile"),c=document.querySelector(".profile__name"),u=document.querySelector(".profile__bio"),i=document.querySelector(".profile__avatar"),l=document.querySelectorAll(".popup__close"),s=document.querySelector(".popup-add-card__form"),d=s.querySelector('[name="card-name"]'),p=s.querySelector('[name="card-link"]'),f=document.querySelector(".popup-add-card"),_=document.querySelectorAll(".popup");function m(e){e.classList.add("popup_opened"),document.addEventListener("keydown",L)}function v(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",L)}function y(){n.value=c.textContent,o.value=u.textContent,r.textContent="Сохранить"}var h=document.querySelector(".popup-update-avatar"),S=document.querySelector(".popup-update-avatar__form"),q=S.querySelector("[name='avatar-link']"),b=S.querySelector(".popup__button");function E(e){i.src=e}function L(e){"Escape"===e.key&&v(document.querySelector(".popup_opened"))}var g=document.querySelector(".popup-card"),k=g.querySelector(".popup-card__photo"),C=g.querySelector(".popup-card__name"),x=document.querySelector(".gallery"),j=document.querySelector("#gallery__card").content;function P(t,n){var o=j.querySelector(".gallery__card").cloneNode(!0);o.querySelector(".gallery__name").textContent=t.name;var r=o.querySelector(".gallery__photo"),a=o.querySelector(".gallery__likes-number");a.textContent=t.likes.length,r.src=t.link,r.alt=t.name,o.dataset.cardId=t._id;var c=o.querySelector(".gallery__delete-card");function u(e){e.classList.toggle("gallery__icon_active")}t.owner._id!=n._id&&(c.setAttribute("disabled","disabled"),c.classList.add("gallery__icon_disabled")),c.addEventListener("click",(function(){var t,n;(n=(t=o).dataset.cardId,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){t.remove()})).catch((function(e){console.log(e)}))}));var i=o.querySelector(".gallery__icon");for(var l in t.likes)if(t.likes[l]._id==n._id){u(i);break}return i.addEventListener("click",(function(){var t;i.classList.contains("gallery__icon_active")?(t=o.dataset.cardId,fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){a.textContent=e.likes.length,u(i)})).catch((function(e){console.log(e)})):function(t){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(o.dataset.cardId).then((function(e){a.textContent=e.likes.length,u(i)})).catch((function(e){console.log(e)}))})),o.querySelector(".gallery__photo-area").addEventListener("click",(function(){var e,n;e=t.name,n=t.link,m(g),k.src=n,k.alt=e,C.textContent=e})),o}function A(e,t){var n=P(e,t);x.prepend(n)}var U,T=function(e,t,n){e.some((function(e){return!e.validity.valid}))?(t.classList.add(n),t.setAttribute("disabled","disabled")):(t.classList.remove(n),t.removeAttribute("disabled","disabled"))},w=document.querySelector(".popup-profile"),B=document.querySelector(".profile__edit-button"),D=document.querySelector(".profile__add-button"),I=document.querySelector(".popup-add-card"),N=document.querySelector(".profile__avatar"),O=document.querySelector(".profile__avatar-area"),J=document.querySelector(".profile__avatar-edit"),G=document.querySelector(".popup-update-avatar");O.addEventListener("mouseover",(function(){N.classList.add("profile__avatar_handel"),J.classList.add("profile__avatar-edit_active")})),O.addEventListener("mouseout",(function(){N.classList.remove("profile__avatar_handel"),J.classList.remove("profile__avatar-edit_active")})),O.addEventListener("click",(function(){m(G)})),l.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return v(t)}))})),y(),B.addEventListener("click",(function(){y(),m(w)})),t.addEventListener("submit",(function(t){var i,l;t.preventDefault(),r.textContent="Сохранение...",(i=n.value,l=o.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:i,about:l})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){c.textContent=n.value,u.textContent=o.value,v(a)})).catch((function(e){console.log(e),v(a)}))})),s.addEventListener("submit",(function(t){var n,o;t.preventDefault(),(n=d.value,o=p.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){A(e,e.owner)})).catch((function(e){console.log(e)})).then((function(){t.target.reset(),v(f)}))})),S.addEventListener("submit",(function(t){var n;t.preventDefault(),b.textContent="Сохранение...",(n=q.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).catch((function(e){console.log(e)})).then((function(){E(q.value),v(h)}))})),D.addEventListener("click",(function(){m(I)})),U={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_visible"},document.querySelectorAll(U.formSelector).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault(),T(t,n,U.inactiveButtonClass)}));var t=Array.from(e.querySelectorAll(U.inputSelector)),n=e.querySelector(U.submitButtonSelector);T(t,n,U.inactiveButtonClass),t.forEach((function(o){o.addEventListener("input",(function(r){!function(e,t,n,o){t.validity.valid?function(e,t,n,o){e.querySelector(".".concat(t.name,"-").concat(n)).textContent="",t.classList.remove(o)}(e,t,n,o):function(e,t,n,o){e.querySelector(".".concat(t.name,"-").concat(n)).textContent=t.validationMessage,t.classList.add(o)}(e,t,n,o)}(e,o,U.inputErrorClass,U.errorClass),T(t,n,U.inactiveButtonClass)}))}))})),_.forEach((function(e){e.querySelector(".popup__container").addEventListener("mousedown",(function(e){e.stopPropagation()})),e.addEventListener("mousedown",(function(t){v(e)}))}));var H,z=document.querySelector(".profile__name"),M=document.querySelector(".profile__bio");fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){return e.json()})).then((function(e){H=e,z.textContent=e.name,M.textContent=e.about,E(e.avatar)})),fetch("".concat(e.baseUrl,"/cards"),{method:"GET",headers:e.headers}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){!function(e,t){for(var n=e.length-1;n>=0;--n)A(e[n],t)}(e,H)})).catch((function(e){console.log(e)}))})();