(()=>{"use strict";var e=document.querySelector(".popup-profile__form"),t=e.querySelector('[name="profile-name"]'),o=e.querySelector('[name="profile-bio"]'),n=e.querySelector(".popup-profile__button"),r=document.querySelector(".popup-profile"),a=document.querySelector(".profile__name"),c=document.querySelector(".profile__bio"),i=document.querySelectorAll(".popup__close"),u=document.querySelector(".popup-add-card__form"),l=u.querySelector('[name="card-name"]'),d=u.querySelector('[name="card-link"]'),s=document.querySelector(".popup-add-card"),p=document.querySelectorAll(".popup");function f(e){e.classList.add("popup_opened"),document.addEventListener("keydown",v)}function m(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",v)}function _(){t.value=a.textContent,o.value=c.textContent,n.textContent="Сохранить"}function v(e){"Escape"===e.key&&m(document.querySelector(".popup_opened"))}var h=document.querySelector(".popup-card"),y=h.querySelector(".popup-card__photo"),b=h.querySelector(".popup-card__name"),S=document.querySelector(".gallery"),q=document.querySelector("#gallery__card").content;function E(e,t){var o=q.querySelector(".gallery__card").cloneNode(!0);o.querySelector(".gallery__name").textContent=e.name;var n=o.querySelector(".gallery__photo"),r=o.querySelector(".gallery__likes-number");r.textContent=e.likes.length,n.src=e.link,n.alt=e.name,o.dataset.cardId=e._id;var a=o.querySelector(".gallery__delete-card");function c(e){e.classList.toggle("gallery__icon_active")}console.log(e.owner),console.log(t),e.owner._id!=t._id&&(a.setAttribute("disabled","disabled"),a.classList.add("gallery__icon_disabled")),a.addEventListener("click",(function(){var e,t;(t=(e=o).dataset.cardId,fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/".concat(t),{method:"DELETE",headers:{authorization:"58e60213-80d2-49f3-ad11-fbf6d1aa4eb4"}}).then((function(e){return e.json()}))).then((function(){e.remove()}))}));var i=o.querySelector(".gallery__icon");for(var u in e.likes)if(e.likes[u]._id==t._id){c(i);break}return i.addEventListener("click",(function(){var e;i.classList.contains("gallery__icon_active")?(e=o.dataset.cardId,fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/likes/".concat(e),{method:"DELETE",headers:{authorization:"58e60213-80d2-49f3-ad11-fbf6d1aa4eb4"}}).then((function(e){return e.json()}))).then((function(e){r.textContent=e.likes.length,c(i)})):function(e){return fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"58e60213-80d2-49f3-ad11-fbf6d1aa4eb4"}}).then((function(e){return e.json()}))}(o.dataset.cardId).then((function(e){r.textContent=e.likes.length,c(i)}))})),o.querySelector(".gallery__photo-area").addEventListener("click",(function(){var t,o;t=e.name,o=e.link,f(h),y.src=o,y.alt=t,b.textContent=t})),o}function g(e,t){var o=E(e,t);S.prepend(o)}var L,C=function(e,t,o){e.some((function(e){return!e.validity.valid}))?(t.classList.add(o),t.setAttribute("disabled","disabled")):(t.classList.remove(o),t.removeAttribute("disabled","disabled"))},k=document.querySelector(".popup-profile"),x=document.querySelector(".profile__edit-button"),A=document.querySelector(".profile__add-button"),j=document.querySelector(".popup-add-card"),T=document.querySelector(".profile__avatar");T.addEventListener("mouseover",(function(){T.classList.add("profile__avatar_handel")})),T.addEventListener("mouseout",(function(){T.classList.remove("profile__avatar_handel")})),i.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return m(t)}))})),_(),x.addEventListener("click",(function(){_(),f(k)})),e.addEventListener("submit",(function(e){var i,u;e.preventDefault(),n.textContent="Сохранение...",(i=t.value,u=o.value,fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/users/me",{method:"PATCH",headers:{authorization:"58e60213-80d2-49f3-ad11-fbf6d1aa4eb4"},body:JSON.stringify({name:i,about:u})}).then((function(e){return e.json()}))).then((function(e){a.textContent=t.value,c.textContent=o.value,m(r)})).catch((function(e){console.log(e),m(r)}))})),u.addEventListener("submit",(function(e){var t,o;e.preventDefault(),(t=l.value,o=d.value,fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards",{method:"POST",headers:{authorization:"58e60213-80d2-49f3-ad11-fbf6d1aa4eb4","Content-Type":"application/json"},body:JSON.stringify({name:t,link:o})}).then((function(e){return e.json()}))).then((function(e){g(e,e.owner)})).catch((function(e){console.log(e)})).then((function(){e.target.reset(),m(s)}))})),A.addEventListener("click",(function(){f(j)})),L={formSelector:".popup__form",inputSelector:".popup__item",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__item_type_error",errorClass:"popup__error_visible"},document.querySelectorAll(L.formSelector).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault(),C(t,o,L.inactiveButtonClass)}));var t=Array.from(e.querySelectorAll(L.inputSelector)),o=e.querySelector(L.submitButtonSelector);C(t,o,L.inactiveButtonClass),t.forEach((function(n){n.addEventListener("input",(function(r){!function(e,t,o,n){t.validity.valid?function(e,t,o,n){e.querySelector(".".concat(t.name,"-").concat(o)).textContent="",t.classList.remove(n)}(e,t,o,n):function(e,t,o,n){e.querySelector(".".concat(t.name,"-").concat(o)).textContent=t.validationMessage,t.classList.add(n)}(e,t,o,n)}(e,n,L.inputErrorClass,L.errorClass),C(t,o,L.inactiveButtonClass)}))}))})),p.forEach((function(e){e.querySelector(".popup__container").addEventListener("mousedown",(function(e){e.stopPropagation()})),e.addEventListener("mousedown",(function(t){m(e)}))}));var w,z=document.querySelector(".profile__name"),B=document.querySelector(".profile__bio");fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/users/me",{method:"GET",headers:{authorization:"58e60213-80d2-49f3-ad11-fbf6d1aa4eb4"}}).then((function(e){return e.json()})).then((function(e){w=e,z.textContent=e.name,B.textContent=e.about})),fetch("https://nomoreparties.co/v1/exp-mipt-fbc-1/cards",{method:"GET",headers:{authorization:"58e60213-80d2-49f3-ad11-fbf6d1aa4eb4"}}).then((function(e){return e.json()})).then((function(e){console.log(e),function(e,t){for(var o=e.length-1;o>=0;--o)g(e[o],t)}(e,w)})).catch((function(e){console.log("Cards Not found")}))})();